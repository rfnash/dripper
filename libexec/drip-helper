#!/usr/bin/env bash

set_variables() {
  STOW=$PACKAGE-$VERSION
  PREFIX=$STOW_PATH/$STOW
}

stow_link() {
  stow -v -d $STOW_PATH $STOW
}

stow_unlink() {
  stow -v -D -d $STOW_PATH $STOW
}

stow_remove() {
  rm -rf $STOW_PATH/$STOW
}

list_drips() {
  { for drip in "${DRIPS_PATH}/"*; do
      echo "${drip##*/}"
    done
  } | sort
}

resolve_link() {
  $(type -p greadlink readlink | head -1) "$1"
}

abs_dirname() {
  local cwd="$(pwd)"
  local path="$1"

  while [ -n "$path" ]; do
    cd "${path%/*}"
    local name="${path##*/}"
    path="$(resolve_link "$name" || true)"
  done

  pwd
  cd "$cwd"
}

DRIPPER_PATH="$(abs_dirname "$0")/.."
DRIPS_PATH="${DRIPPER_PATH}/share/dripper"
